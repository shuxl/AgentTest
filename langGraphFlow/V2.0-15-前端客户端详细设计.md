# 1、功能描述

前端客户端是多智能体路由系统的用户交互界面，提供命令行界面（CLI）用于与后端API进行对话交互。前端客户端负责用户输入、消息显示、会话管理等功能，为用户提供友好的对话体验。

# 2、需求

## 2.1 功能需求

| JIRA编号 | 产品/子系统/服务 | 功能 | 功能描述 |
| ------ | ------ | ------ | ------ |
| FRONTEND-001 | 前端客户端 | 用户输入 | 接收用户输入的消息并发送到后端API |
| FRONTEND-002 | 前端客户端 | 消息显示 | 显示智能体的回复消息，格式化输出 |
| FRONTEND-003 | 前端客户端 | 会话管理 | 管理用户ID和会话ID，支持创建新会话和恢复已有会话 |
| FRONTEND-004 | 前端客户端 | 对话历史 | 显示对话历史记录 |
| FRONTEND-005 | 前端客户端 | 错误处理 | 处理API调用错误，显示友好的错误提示 |

## 2.2 非功能需求

| 非功能需求 | 需求描述 |
| ------ | ------ |
| 响应 | 用户输入响应时间 < 100ms，消息显示流畅 |
| 易用性 | 界面友好，操作简单直观 |
| 可靠性 | 网络错误时能够重试，异常情况下优雅降级 |
| 兼容性 | 支持Python 3.10+，支持Windows、macOS、Linux |

# 3、技术设计

## 3.1 设计思路

前端客户端基于Python的Rich库实现，采用以下设计思路：

1. **命令行界面**：使用Rich库提供美观的命令行界面
2. **异步通信**：使用httpx异步HTTP客户端与后端API通信
3. **会话管理**：自动管理用户ID和会话ID，支持会话恢复
4. **错误处理**：友好的错误提示和重试机制

## 3.2 设计图(流程图/时序图/其他)

### 3.2.1 前端客户端启动流程

```
启动前端客户端
    ↓
显示欢迎信息
    ↓
获取用户ID（支持输入或使用默认值）
    ↓
查询用户活跃会话（调用后端API）
    ↓
如果存在活跃会话 → 恢复会话
如果不存在 → 创建新会话
    ↓
显示会话信息
    ↓
进入主交互循环
```

### 3.2.2 对话交互流程

```
用户输入消息
    ↓
发送POST请求到后端API（/api/chat）
    ↓
显示"正在处理..."提示
    ↓
等待后端响应
    ↓
接收响应
    ├─ 成功 → 显示智能体回复
    └─ 失败 → 显示错误提示
    ↓
更新对话历史
    ↓
继续等待用户输入
```

### 3.2.3 会话恢复流程

```
启动时查询用户活跃会话
    ↓
调用GET /api/sessions/{user_id}
    ↓
如果存在活跃会话
    ├─ 显示会话信息
    ├─ 询问是否恢复
    └─ 用户确认 → 使用已有会话ID
    ↓
如果不存在活跃会话
    └─ 创建新会话ID
```

## 3.3 ER设计

前端客户端不涉及数据库表设计，会话信息存储在内存中，通过后端API管理。

## 3.4 接口设计

### 3.4.1 接口清单

前端客户端调用后端API接口：

| 接口地址 | 接口名称 | 备注 |
| ------ | ------ | ------ |
| POST /api/chat | 对话接口 | 发送用户消息，获取智能体回复 |
| GET /api/sessions/{user_id} | 查询用户会话 | 查询用户的活跃会话（可选） |
| GET /api/system/info | 系统信息 | 查询系统信息（可选） |

### 3.4.2 接口调用示例

#### 功能描述：对话接口调用

<table>
    <th colspan="4">功能描述：<span>发送用户消息，获取智能体回复</span></th>
    <tr>
        <td colspan="4"> JIRA链接: <span>FRONTEND-001</span></td>
    </tr>
    <tr>
        <td>请求方式</td><td colspan="3">POST</td>
    </tr>
    <tr>
        <td>请求URL</td><td colspan="3">http://localhost:8001/api/chat</td>
    </tr>
    <tr>
        <td colspan="4"> 请求参数</td>
    </tr>
    <tr>
        <td>参数名</td><td>类型</td><td>是否必填</td><td>描述</td>
    </tr>
    <tr>
        <td>message</td><td>str</td><td>Y</td><td>用户消息内容</td>
    </tr>
    <tr>
        <td>session_id</td><td>str</td><td>Y</td><td>会话ID</td>
    </tr>
    <tr>
        <td>user_id</td><td>str</td><td>Y</td><td>用户ID</td>
    </tr>
    <tr>
        <td colspan="4"> 响应</td>
    </tr>
    <tr>
        <td>参数名</td><td>类型</td><td colspan="2">描述</td>
    </tr>
    <tr>
        <td>response</td><td>str</td><td colspan="2">智能体回复内容</td>
    </tr>
    <tr>
        <td>current_intent</td><td>str</td><td colspan="2">当前意图</td>
    </tr>
    <tr>
        <td>current_agent</td><td>str</td><td colspan="2">当前活跃的智能体</td>
    </tr>
</table>

## 3.5 其他

### 3.5.1 技术实现

**主要依赖库**：
- `rich`：命令行界面美化
- `httpx`：异步HTTP客户端
- `typing`：类型提示

**核心功能模块**：
1. **用户输入模块**：使用Rich的Prompt获取用户输入
2. **API通信模块**：使用httpx异步调用后端API
3. **消息显示模块**：使用Rich格式化显示消息
4. **会话管理模块**：管理用户ID和会话ID

### 3.5.2 界面设计

**欢迎界面**：
- 显示系统标题和欢迎信息
- 显示当前系统状态（会话数、用户数等）

**对话界面**：
- 用户消息：右对齐，蓝色显示
- 智能体回复：左对齐，绿色显示
- 系统提示：黄色显示
- 错误信息：红色显示

**会话信息显示**：
- 显示当前用户ID
- 显示当前会话ID
- 显示会话状态

### 3.5.3 错误处理

- **网络错误**：显示友好的错误提示，支持重试
- **API错误**：显示后端返回的错误信息
- **超时错误**：显示超时提示，支持重试
- **异常情况**：捕获所有异常，显示友好的错误提示

### 3.5.4 配置说明

- **后端API地址**：通过环境变量或配置文件配置（默认：http://localhost:8001）
- **超时设置**：默认30秒，可通过配置调整
- **重试次数**：默认3次，可通过配置调整

